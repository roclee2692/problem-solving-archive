【模板学习 FAQ】

=== Week 1: 图论基础 ===

【Dijkstra 常见问题】
Q: 为什么要用 priority_queue，不能用简单循环？
A: Dijkstra 需要每次选最小距离的节点，priority_queue 支持 O(log n)，
   简单循环是 O(n)，总复杂度差异：O(n²) vs O((n+m)log n)

Q: dist[v] < INF 的判断有什么用？
A: 有些题目只连接图的一部分，不是强连通图。这个判断防止到达不了的节点输出 INF

Q: 能处理负权边吗？
A: 不能！Dijkstra 基于贪心，假设已确定的距离不会再更新。如有负权边，用 SPFA

【SPFA 常见问题】
Q: SPFA 和 Bellman-Ford 的区别？
A: SPFA 是 BF 的优化版本（用队列记录待松弛节点），平均复杂度 O(E)，
   最坏仍是 O(VE)。负环检测：cnt[v] > n 时存在负环

Q: 为什么有的题 SPFA 会 TLE？
A: 某些构造的图会让 SPFA 退化到 O(VE)。此时考虑用 Dijkstra + 势能函数（Johnson）

【Floyd 常见问题】
Q: 为什么 k 必须在最外层？
A: Floyd 是基于 DP 的（决策阶段是选择中间点），k 是阶段数。
   如果 k 不是最外层，会重复使用中间结果，导致错误

Q: 能检测负环吗？
A: 能！结束后检查 dist[i][i] < 0 的节点就是负环

【DSU 常见问题】
Q: find 函数为什么要路径压缩？
A: 不压缩的话，树可能退化成链，单次查询 O(n)。
   压缩后平均接近 O(1)（不是真的常数，更准确是反阿克曼函数）

Q: union 和 unite 有什么区别？
A: unite 是带秩优化的 union，按秩（树的高度）而不是任意连接。
   这样能保证树不会太深

【Kruskal 常见问题】
Q: 为什么先排序边？
A: Kruskal 是贪心：始终选最小边。排序使得边可以按大小逐个考虑。
   无排序就要搜索，非常慢

Q: 为什么选边不选点？
A: 点的顺序不重要（无向图），边的大小才是关键。
   贪心原理：最小边一定在 MST 中

=== Week 2: 字符串算法 ===

【KMP 常见问题】
Q: next 数组的含义？
A: next[i] = 最长的 proper prefix 的长度，同时是 s[0..i] 的后缀。
   用来在失配时跳过已匹配的部分

Q: next 数组为什么从 0 开始？
A: 传统写法：next[0] = 0（空前缀），next[i] 表示到位置 i 的信息。
   有的写法从 1 开始，需要对应调整

【String Hash 常见问题】
Q: 哈希碰撞怎么办？
A: 单哈希碰撞概率极低（使用质数 MOD）。但竞赛不稳定的话用双哈希。
   双哈希：两个 MOD 同时计算，碰撞概率几乎为 0

Q: 为什么字符映射要 +1？
A: 避免字符 'a' 被映射为 0。哈希中 0 有特殊含义（未初始化），
   加 1 让所有字符对应非零值

【Trie 常见问题】
Q: Trie 比字符串直接比较快在哪里？
A: 按前缀聚类。查询 "test" 时，前 3 个字符就能排除大量字符串。
   直接比较需要逐个检查整个字符串

Q: 如何统计经过节点的字符串数？
A: 在每个节点加 cnt++。查询子树时，直接读 cnt 值，无需遍历

【AC 自动机常见问题】
Q: fail 链和 KMP 的 next 有什么区别？
A: fail 链是树的指针（多个子节点），next 是字符串的指针。
   AC 自动机在 KMP 基础上，处理多模式和树状结构

Q: 为什么要完全填充 go 数组？
A: 避免查询时越界或处理复杂的条件。完全填充后，任何字符都有转移

=== Week 3: 数据结构 ===

【BIT 常见问题】
Q: lowbit 函数如何理解？
A: lowbit(x) = x & (-x) 提取 x 的最低位 1。
   例：x=12=1100，-x 取反+1=0100，x&(-x)=0100=4

Q: 为什么索引从 1 开始？
A: 树状数组的下标有二进制含义。0 是特殊值，从 1 开始便于位运算

【线段树常见问题】
Q: 为什么要 lazy 标记？
A: 区间更新时，若逐个更新子节点，复杂度退化到 O(n)。
   lazy 标记允许延迟更新，维持 O(log n)

Q: push_down 什么时候调用？
A: 访问子树前必须调用。确保子节点的 lazy 标记被处理，获得正确的值

【LCA 常见问题】
Q: 二进制提升的原理？
A: up[u][i] 存储第 2^i 个祖先。查询时按二进制位跳跃。
   例：找第 13 个祖先 = 第 8 + 第 4 + 第 1 个祖先

Q: 为什么不能同时向上跳到 LCA？
A: 因为 LCA 可能在不同的分支。先对齐深度，再同步向上。
   不同步会导致一个节点早到 LCA，另一个还没到

【主席树常见问题】
Q: 为什么叫"主席树"？
A: 出自某竞赛的题目。主席树是可持久化线段树，能查询历史版本。
   每次查询可以指定"哪一版本"

Q: 和普通线段树的主要区别？
A: 普通线段树修改会覆盖，主席树保留所有版本。
   空间换时间：O(n) 线段树 vs O(n log n) 主席树

=== Week 4: 数论算法 ===

【快速幂常见问题】
Q: 为什么 a 要先 % mod？
A: 如果 a > mod，相当于预先化简。同时防止 a*a 溢出

Q: __int128 什么时候用？
A: 两个大数相乘且需要精确结果（不能直接 % mod）时。
   例：快速乘 (ll)a * b % mod

【扩展欧几里得常见问题】
Q: 回溯公式为什么是 x = y1？
A: 由 gcd(b, a%b) 的解推导得出。数学推导见下面的详细说明

Q: 怎么判断线性方程无解？
A: 若 c % gcd(a, b) ≠ 0，则无整数解。
   直观理解：右边必须是左边 gcd 的倍数

【中国剩余定理常见问题】
Q: 为什么要求模数两两互质？
A: 若不互质，同一个余数可能对应多个解。互质时唯一解（在 LCM 范围内）

Q: 扩展 CRT 怎么处理非互质的情况？
A: 两两合并（逐个方程）。若某次合并时 (a2-a1) % gcd(m1,m2) ≠ 0，无解

【素数筛常见问题】
Q: 线性筛中 if(i % p == 0) break 的作用？
A: 防止重复筛。若 i 能被 p 整除，i*q (q>p质数) 会被更小质因子筛到。
   break 确保每个合数只被其最小质因子筛一次

Q: 埃筛 vs 线性筛选哪个？
A: n ≤ 1e7：优先线性筛（常数好）
   n ≤ 1e6：埃筛也可以
   需要最小质因子：必须线性筛

=== Week 5: 高级图论 ===

【拓扑排序常见问题】
Q: 如何判断图有环？
A: 拓扑排序后，若输出节点数 < n，说明有环（某些节点入度始终 > 0）

Q: 多个合法拓扑排序怎么选？
A: 用 priority_queue 替代普通 queue，即可得到字典序最小的排序

【Tarjan 常见问题】
Q: dfn 和 low 的区别？
A: dfn[u] 是 u 的发现时间戳（固定）
   low[u] 是 u 的最低可达时间戳（可以通过回边更新）

Q: SCC 的根为什么是 dfn[u] == low[u]？
A: 这说明 u 是某个强连通分量的"入口"，无法从更早的节点到达。
   由此分出一个完整的 SCC

【桥与割点常见问题】
Q: 桥的判定是 low[v] > dfn[u] 还是 ≥？
A: 必须是 >。dfn[u] == low[v] 时，存在返回边，仍可绕过

Q: 割点中为什么有 low[v] >= dfn[u]？
A: ≥ 而非 > 是因为：v 的子树完全"卡"在 u 这个点上，
   无法绕过 u 到达更早的节点

=== Week 6: 动态规划 ===

【位运算 DP 常见问题】
Q: 子集枚举 (sub-1)&mask 为什么这样写？
A: 从 mask 开始，每次减去最小的 1 位（由 -1 产生）。
   这样遍历所有子集且顺序由大到小

Q: 怎么判断某位是否在状态中？
A: (mask >> i) & 1 或 (mask & (1<<i)) 都可以

【树形 DP 常见问题】
Q: 为什么需要记录"选/不选"两种状态？
A: 某些转移关系依赖父节点的状态。
   例：若父亲不选，子节点可选；父亲选，子节点不能选

Q: 怎么避免走回头路？
A: dfs 时传入父节点参数 p，跳过 if(v == p)

【矩阵快速幂常见问题】
Q: 矩阵构造中第一行为什么放系数？
A: 这样矩阵的第一行代表下一状态的计算公式。
   乘以初值向量后，第一个分量就是答案

Q: 什么时候用矩阵快速幂？
A: 当递推式是线性的，且 n 非常大（> 1e9）时。
   否则直接递推或 O(n) DP 足够

=== 🎯 总结小贴士 ===

记住以下规则，题目就不怕：

图论:
  最短路 → Dijkstra / SPFA / Floyd
  最小生成树 → Kruskal / Prim + 并查集
  连通性 → DSU / DFS / BFS

字符串:
  单串查找 → KMP / 2-pointer
  多串查找 → AC 自动机
  比较相等 → 哈希

数据结构:
  单点更新/区间查询 → BIT
  区间更新/区间查询 → 线段树
  树上距离 → LCA
  历史查询 → 主席树

数论:
  大指数 → 快速幂
  线性方程 → 扩展欧几里得
  同余方程组 → 中国剩余定理
  质因数 → 埃筛/线性筛

高级图论:
  拓扑排序 → 任务调度、DAG DP
  连通分量 → Tarjan
  关键边/点 → 桥与割点

动态规划:
  小范围集合 → 位运算 DP
  树上问题 → 树形 DP
  线性递推 → 矩阵快速幂

如果题目 30 分钟还没思路，参考上面的分类提示！

---

最后更新: 2025-10-25
建议: 学每个模板时，把对应 FAQ 部分再读一遍
