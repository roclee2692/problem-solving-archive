# 教师科研工作量管理系统 - 架构分析文档

## 📊 系统架构全景图

```
┌────────────────────────────────────────────────────────────────┐
│                  教师科研工作量管理系统 (594行)                     │
│                        C++ 控制台应用                             │
├────────────────────────────────────────────────────────────────┤
│ 【第1层】数据层 - 3个核心结构体                                    │
│  ┌──────────────┬──────────────┬──────────────┐                │
│  │  College     │    User      │    Apply     │                │
│  │  学院信息     │   用户信息    │   申报记录    │                │
│  ├──────────────┼──────────────┼──────────────┤                │
│  │ • cid        │ • uid (工号) │ • aid        │                │
│  │ • name       │ • cid        │ • type (1论文│                │
│  │              │ • name       │   2项目3经费) │                │
│  │              │ • password   │ • uid        │                │
│  │              │ • role (0教师│ • year       │                │
│  │              │   1管理员)   │ • title/level│                │
│  │              │              │ • ord/amount │                │
│  │              │              │ • status (0待│                │
│  │              │              │   1通过2驳回)│                │
│  │              │              │ • score      │                │
│  │              │              │ • feedback   │                │
│  └──────────────┴──────────────┴──────────────┘                │
│                                                                 │
│  全局容器：                                                       │
│  • vector<College> colleges;                                   │
│  • vector<User> users;                                         │
│  • vector<Apply> applies;                                      │
├────────────────────────────────────────────────────────────────┤
│ 【第2层】工具层 - 8个核心工具函数                                  │
│  ┌──────────────────────────────────────────────────────┐      │
│  │ ① splitByBar(string) → vector<string>                │      │
│  │    字符串分割："1|张三|123" → ["1","张三","123"]       │      │
│  │                                                       │      │
│  │ ② trim(string) → string                              │      │
│  │    去空格："  hello  " → "hello"                      │      │
│  │                                                       │      │
│  │ ③ findCollegeIdx(cid) → int                          │      │
│  │ ④ findUserIdxByUid(uid) → int                        │      │
│  │ ⑤ findApplyIdx(aid) → int                            │      │
│  │    线性查找封装（返回索引，-1表示未找到）              │      │
│  │                                                       │      │
│  │ ⑥ nextApplyId() → ll                                 │      │
│  │    生成新ID（遍历找最大值+1）                          │      │
│  │                                                       │      │
│  │ ⑦ scorePaper/scoreProject/scoreFund                  │      │
│  │    计分规则函数（策略模式）                            │      │
│  │                                                       │      │
│  │ ⑧ calcScore(Apply) → double                          │      │
│  │    根据type分发到不同计分函数                          │      │
│  └──────────────────────────────────────────────────────┘      │
├────────────────────────────────────────────────────────────────┤
│ 【第3层】持久化层 - 文件读写                                       │
│  ┌──────────────────────────────────────────────────────┐      │
│  │ colleges.txt  ← loadColleges() / saveColleges()      │      │
│  │   格式: cid|name                                      │      │
│  │   示例: 1|计算机学院                                   │      │
│  │                                                       │      │
│  │ users.txt     ← loadUsers() / saveUsers()            │      │
│  │   格式: uid|cid|name|password|role                    │      │
│  │   示例: 101|1|张三|123|0                              │      │
│  │                                                       │      │
│  │ applies.txt   ← loadApplies() / saveApplies()        │      │
│  │   格式: aid|type|uid|year|title|level|ord|amount|    │      │
│  │         status|score|feedback                         │      │
│  │   示例: 1|1|101|2025|论文标题|国家级|1|0|0|0|         │      │
│  │                                                       │      │
│  │ loadAll()  - 按顺序加载3个文件                         │      │
│  │ saveAll()  - 统一保存3个文件                           │      │
│  └──────────────────────────────────────────────────────┘      │
├────────────────────────────────────────────────────────────────┤
│ 【第4层】业务逻辑层 - 功能函数                                     │
│  ┌────────────────────┬────────────────────────────────┐      │
│  │  教师端功能         │  管理员端功能                   │      │
│  ├────────────────────┼────────────────────────────────┤      │
│  │ submitPaper()      │ addCollege()                   │      │
│  │ submitProject()    │ delCollege()                   │      │
│  │ submitFund()       │ editCollege()                  │      │
│  │                    │ showColleges()                 │      │
│  │ viewMyApplies()    │                                │      │
│  │ (查看本人申报)      │ addUser()                      │      │
│  │                    │ delUser()                      │      │
│  │                    │ editUser()                     │      │
│  │                    │ showUsers()                    │      │
│  │                    │                                │      │
│  │                    │ reviewOne()                    │      │
│  │                    │ (审核申报)                      │      │
│  │                    │                                │      │
│  │                    │ statsTeacher()                 │      │
│  │                    │ statsCollege()                 │      │
│  │                    │ (统计汇总)                      │      │
│  └────────────────────┴────────────────────────────────┘      │
├────────────────────────────────────────────────────────────────┤
│ 【第5层】交互层 - 菜单系统                                         │
│  ┌──────────────────────────────────────────────────────┐      │
│  │ login() → bool                                        │      │
│  │   输入工号密码，验证身份，设置全局变量 cur_uid/cur_role │      │
│  │                                                       │      │
│  │ teacherMenu()                                         │      │
│  │   while循环 + switch(choice)                          │      │
│  │   1. 申报论文                                          │      │
│  │   2. 申报项目                                          │      │
│  │   3. 申报经费                                          │      │
│  │   4. 查看我的申报                                       │      │
│  │   0. 退出                                              │      │
│  │                                                       │      │
│  │ adminMenu()                                           │      │
│  │   while循环 + switch(choice)                          │      │
│  │   1. 学院管理（增删改查）                               │      │
│  │   2. 教师管理（增删改查）                               │      │
│  │   3. 审核申报                                          │      │
│  │   4. 统计查询                                          │      │
│  │   0. 退出                                              │      │
│  └──────────────────────────────────────────────────────┘      │
├────────────────────────────────────────────────────────────────┤
│ 【第6层】主程序 main()                                            │
│  1. loadAll()        - 启动时加载历史数据                        │
│  2. login()          - 用户登录                                 │
│  3. if role==0: teacherMenu() else: adminMenu()                │
│  4. saveAll()        - 退出时保存数据                            │
└────────────────────────────────────────────────────────────────┘
```

---

## 🎯 核心知识点对比分析

### 你已掌握 ✓（第2步学习笔记）

| 功能 | 代码行数 | 核心技术 |
|------|---------|---------|
| login() | 15行 | 线性查找、bool返回值 |
| submitPaper() | 20行 | ID生成、cin.ignore() |
| reviewApply() | 25行 | 数组遍历、状态更新 |
| saveApplies() | 15行 | 文件写入、管道分隔符 |
| loadApplies() | 25行 | stringstream、stoi/stod |

**总计：100行核心代码**

---

### 需要新学的 ⭐（第3步高级功能）

| 优先级 | 知识点 | 应用场景 | 难度 | 时间 |
|-------|--------|---------|------|------|
| ★★★★★ | splitByBar() | 替代手动字符串解析，提高代码复用性 | 中 | 20分钟 |
| ★★★★★ | CRUD模式 | 学院/用户管理的增删改查标准写法 | 中 | 30分钟 |
| ★★★★★ | unordered_map汇总 | 统计每个教师总分（按uid分组求和） | 高 | 40分钟 |
| ★★★★★ | sort + lambda | 按总分降序排序教师/学院 | 中 | 20分钟 |
| ★★★☆☆ | trim() | 清理文件读取的脏数据 | 低 | 10分钟 |
| ★★★☆☆ | function<> | 动态过滤条件（showAppliesFiltered） | 中 | 15分钟 |
| ★★☆☆☆ | numeric_limits | 彻底清除输入缓冲区 | 低 | 5分钟 |
| ★★☆☆☆ | 策略模式 | 不同类型申报的计分规则封装 | 中 | 20分钟 |

**总计：需新学约160分钟（2.7小时）**

---

## 📝 完整系统函数清单

### 数据层（3个结构体）
- `struct College`
- `struct User`
- `struct Apply`

### 工具层（8个函数）
1. `splitByBar(string)` - 字符串分割
2. `trim(string)` - 去空格
3. `findCollegeIdx(cid)` - 查找学院索引
4. `findUserIdxByUid(uid)` - 查找用户索引
5. `findApplyIdx(aid)` - 查找申报索引
6. `nextApplyId()` - 生成新ID
7. `scorePaper/Project/Fund()` - 计分规则
8. `calcScore(Apply)` - 统一计分入口

### 持久化层（8个函数）
1. `loadColleges()`
2. `saveColleges()`
3. `loadUsers()`
4. `saveUsers()`
5. `loadApplies()`
6. `saveApplies()`
7. `loadAll()`
8. `saveAll()`

### 展示层（4个函数）
1. `typeName(ll)` - 类型名转换
2. `statusName(ll)` - 状态名转换
3. `showColleges()`
4. `showUsers()`
5. `showAppliesFiltered(function<>)` - 动态过滤显示

### 业务层 - 教师端（4个函数）
1. `submitPaper()` - 论文申报
2. `submitProject()` - 项目申报
3. `submitFund()` - 经费申报
4. `viewMyApplies()` - 查看本人申报

### 业务层 - 管理员端（10个函数）
1. `addCollege()` - 添加学院
2. `delCollege()` - 删除学院
3. `editCollege()` - 修改学院
4. `addUser()` - 添加用户
5. `delUser()` - 删除用户
6. `editUser()` - 修改用户
7. `reviewOne()` - 审核申报
8. `statsTeacher()` - 教师统计
9. `statsCollege()` - 学院统计
10. `delApply()` - 删除申报（可选）

### 交互层（4个函数）
1. `login()` - 登录验证
2. `logout()` - 登出
3. `teacherMenu()` - 教师菜单
4. `adminMenu()` - 管理员菜单

### 主程序
- `main()` - 程序入口

**总函数数量：41个**  
**核心复杂函数：8个（需重点学习）**

---

## 🚀 学习路径建议

### 第1阶段：理解架构（30分钟）
1. 阅读本文档，理解6层架构
2. 对比第2步笔记，找出差异
3. 明确需要新学的8个知识点

### 第2阶段：手敲核心（2.5小时）
按优先级练习 `学习笔记-第3步-高级功能.cpp`：
1. ⭐⭐⭐⭐⭐ splitByBar（20分钟）
2. ⭐⭐⭐⭐⭐ CRUD增删改查（30分钟）
3. ⭐⭐⭐⭐⭐ unordered_map汇总（40分钟）
4. ⭐⭐⭐⭐⭐ sort + lambda排序（20分钟）
5. ⭐⭐⭐ trim（10分钟）
6. ⭐⭐⭐ function<>回调（15分钟）
7. ⭐⭐ numeric_limits（5分钟）
8. ⭐⭐ 策略模式（20分钟）

### 第3阶段：对照理解（1小时）
1. 打开 `教师科研工作量管理系统.cpp`
2. 逐个对照你练习的8个知识点
3. 理解它们如何组合成完整系统
4. 标记你仍不理解的部分

### 第4阶段：运行测试（1小时）
1. 编译完整系统
2. 准备测试数据（colleges.txt, users.txt）
3. 测试完整流程：
   - 登录（教师+管理员）
   - 申报（论文/项目/经费）
   - 审核（通过/驳回）
   - 统计（教师/学院）
4. 截图每个功能作为报告素材

---

## 💡 代码复杂度分析

### 难度分级
- 🟢 简单（你已掌握）：login, submitPaper, saveApplies
- 🟡 中等（需学习）：splitByBar, CRUD, trim, function<>
- 🔴 困难（重点攻克）：unordered_map汇总, sort+lambda, 多表联查

### 关键难点
1. **unordered_map 统计汇总**（第4层）
   - 问题：如何按 uid 分组计算总分？
   - 技术：`unordered_map<ll, double> scoreMap`
   - 难点：需理解哈希表的 `scoreMap[uid] += score` 自动累加机制

2. **sort + lambda 排序**（第4层）
   - 问题：如何自定义排序规则？
   - 技术：`sort(vec.begin(), vec.end(), [](a,b){...})`
   - 难点：lambda表达式语法和闭包理解

3. **function<> 回调函数**（第3层）
   - 问题：如何动态传递过滤条件？
   - 技术：`function<bool(const Apply&)> filter`
   - 难点：函数作为参数传递的概念

---

## 📋 学习检查清单

完成以下任务，你就完全掌握了这个系统：

### 基础巩固（你已会✓）
- [x] 理解 struct 定义和使用
- [x] 掌握 vector 的 push_back/遍历/索引访问
- [x] 会用 ifstream/ofstream 读写文件
- [x] 理解 cin/cout/getline 的区别
- [x] 会用 stoi/stod 转换字符串

### 新知识点（第3步必学）
- [ ] 手写 splitByBar() 并测试通过
- [ ] 手写 trim() 并测试通过
- [ ] 实现 editCollege() CRUD操作
- [ ] 用 unordered_map 完成教师统计
- [ ] 用 sort + lambda 实现自定义排序
- [ ] 理解 function<> 回调机制
- [ ] 会用 numeric_limits 清缓冲
- [ ] 实现 scoreProject() 计分规则

### 系统理解（第4步综合）
- [ ] 能画出系统6层架构图
- [ ] 说出3个文件的格式和作用
- [ ] 理解教师端和管理员端的功能差异
- [ ] 能解释 login() 如何验证身份并分流
- [ ] 知道 nextApplyId() 的ID生成策略
- [ ] 理解 statsTeacher() 的统计逻辑

### 实战能力（最终目标）
- [ ] 能独立编译运行完整系统
- [ ] 能准备测试数据并演示所有功能
- [ ] 能修改计分规则并验证生效
- [ ] 能添加新功能（如删除申报记录）
- [ ] 能画出系统流程图
- [ ] 能写出功能说明文档

---

## 🎓 实习汇报建议

### 技术亮点（向老师展示）
1. **模块化设计**：6层架构，职责清晰
2. **CRUD完整实现**：学院/用户/申报的增删改查
3. **统计分析功能**：unordered_map汇总 + sort排序
4. **动态过滤显示**：function<> 回调函数应用
5. **策略模式**：不同类型申报的计分规则封装
6. **数据持久化**：3个txt文件联合管理

### 创新点（加分项）
- 可改进为从配置文件读取计分规则
- 可添加数据备份/恢复功能
- 可实现批量导入/导出Excel
- 可优化为二级菜单交互
- 可添加日志记录功能

### 截图清单
1. 登录界面（教师+管理员）
2. 教师申报界面（论文/项目/经费）
3. 管理员审核界面
4. 统计查询界面（教师/学院排序）
5. 学院管理界面（CRUD）
6. 数据文件内容展示（colleges.txt等）

---

## 📞 后续支持

如果在学习过程中遇到问题：
1. **不理解某个函数**：定位到第3步笔记对应章节，先看示例
2. **代码报错**：检查是否缺少头文件、类型转换错误
3. **逻辑不清楚**：回到本文档看架构图，理解数据流向
4. **想扩展功能**：先在第3步笔记里实现小demo，再集成到完整系统

祝学习顺利！🎉
